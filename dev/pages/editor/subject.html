<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="/dev/style.css" />
  <link href="/assets/bootstrap-icons.css" rel="stylesheet" type="text/css" />
  <style>html,body{background:transparent}body{padding:0 12px 12px}.pageTitle{margin-left:0;margin-right:0;width:100%}</style>
  <script type="module">
    import {allComponents, provideFluentDesignSystem, baseLayerLuminance, StandardLuminance} from 'https://npm.elemecdn.com/@fluentui/web-components';
    provideFluentDesignSystem().register(allComponents);
    try {
      const layer = document.body;
      const isDark = (()=>{ try { return !!(parent && parent.document && parent.document.body && parent.document.body.classList && parent.document.body.classList.contains('darkmode--activated')); } catch { return false } })();
      baseLayerLuminance.setValueFor(layer, isDark ? StandardLuminance.DarkMode : StandardLuminance.LightMode);
    } catch {}
  </script>
  <script>
    try { if (parent) parent.postMessage({ type: 'iframe-start' }, '*'); } catch {}
    (function(){
      try {
        var _ol = console.log; var _oe = console.error;
        console.log = function(){ try { var msg = Array.prototype.slice.call(arguments).join(' '); if (parent) parent.postMessage({ type: 'iframe-log', text: msg }, '*'); } catch {} try { _ol.apply(console, arguments); } catch {} };
        console.error = function(){ try { var msg = Array.prototype.slice.call(arguments).join(' '); if (parent) parent.postMessage({ type: 'iframe-log', text: msg }, '*'); } catch {} try { _oe.apply(console, arguments); } catch {} };
      } catch {}
    })();
  </script>
  <script src="/dev/scripts/storage.js" defer></script>
  <script src="/dev/scripts/subject.js" defer></script>
  
</head>
<body>
<p class="pageTitle pageTitle_main">科目编辑</p>
<div id="subject-form">
  <div class="settings-card">
    <i class="bi bi-bookmark"></i>
    <div class="left-section">
      <div class="title">科目名称</div>
      <div class="description">科目的完整名称</div>
    </div>
    <div class="right-section">
      <fluent-text-field type="text" id="subject-name" placeholder="科目名称">
      </fluent-text-field>
    </div>
  </div>
  <div class="settings-card">
    <i class="bi bi-bookmark-dash"></i>
    <div class="left-section">
      <div class="title">科目简称</div>
      <div class="description">科目的简写名称</div>
    </div>
    <div class="right-section">
      <fluent-text-field type="text" id="subject-simple" placeholder="简称">
      </fluent-text-field>
    </div>
  </div>
  <div class="settings-card">
    <i class="bi bi-person-check"></i>
    <div class="left-section">
      <div class="title">任科教师</div>
      <div class="description">[可选]任课教师的姓名</div>
    </div>
    <div class="right-section">
      <fluent-text-field
        type="text"
        id="subject-teacher"
        placeholder="任课教师"
      >
      </fluent-text-field>
    </div>
  </div>
  <div class="settings-card">
    <i class="bi bi-flag"></i>
    <div class="left-section">
      <div class="title">教学教室</div>
      <div class="description">[可选]上课的教室标识</div>
    </div>
    <div class="right-section">
      <fluent-text-field type="text" id="subject-room" placeholder="教室">
      </fluent-text-field>
    </div>
  </div>
  <div
    class="settings-card"
    style="background-color: transparent; border: none"
  >
    <div class="left-section"></div>
    <div class="right-section">
      <fluent-button
        appearance="accent"
        onclick="subjects.save()"
        style="margin-left: auto; width: 178px"
      >
        保存
      </fluent-button>
    </div>
  </div>
</div>
<script>
  (function(){
    console.log('editor:subject start');
    const run = () => {
      try {
        if (!(window.storage && window.subjects)) { console.log('editor:subject waiting libs'); setTimeout(run, 50); return; }
        storage.init(); storage.initEnv(); console.log('editor:subject after storage.init');
        // 不在子页面渲染侧栏列表，跳过 subjects.init()
        const p = new URLSearchParams(location.search);
        const idx = parseInt(p.get('subject'));
        const name = p.get('subjectName');
        let i = idx;
        if (isNaN(i) && name) { i = (currentData.subjects || []).findIndex(s => s && s.name === name); }
        if (!isNaN(i) && i >= 0) { subjects.load(i, false); console.log('editor:subject subjects.load by params', i); }
        else {
          if (Array.isArray(currentData.subjects) && currentData.subjects.length > 0) { subjects.load(0, false); console.log('editor:subject subjects.load fallback 0'); }
          else { console.log('editor:subject no subjects'); }
        }
        try { window.__unsaved = window.__unsaved || false; window.__unsynced = window.__unsynced || false; } catch {}
      } catch (e) { console.error('editor:subject init error', e); }
    };
    if (document.readyState === 'loading') { document.addEventListener('DOMContentLoaded', run); } else { run(); }
  })();
  try { if (parent) parent.postMessage({ type: 'iframe-ready' }, '*'); } catch {}
  </script>
</body>
</html>
